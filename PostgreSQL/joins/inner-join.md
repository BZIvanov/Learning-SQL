# Inner Join

### Basic inner join

- Inner join will return result which are match in both tables.

**_users_**

| id<sup>PK</sup> | name   |
| --------------- | ------ |
| 1               | Mira   |
| 2               | Sofia  |
| 3               | Ivan   |
| 4               | Metodi |
| 5               | Marina |

**_images_**

| id<sup>PK</sup> | url         | user_id<sup>FK</sup> |
| --------------- | ----------- | -------------------- |
| 1               | image-1.png | 1                    |
| 2               | image-2.png | 1                    |
| 3               | image-3.png | 2                    |
| 4               | image-4.png | 2                    |
| 5               | image-5.png | 3                    |

```sql
SELECT u.id AS uid, name, i.id AS iid, url, user_id
FROM users AS u INNER JOIN images AS i ON u.id = i.user_id;
```

| uid | name  | iid | url         | user_id |
| --- | ----- | --- | ----------- | ------- |
| 1   | Mira  | 1   | image-1.png | 1       |
| 1   | Mira  | 2   | image-2.png | 1       |
| 2   | Sofia | 3   | image-3.png | 2       |
| 2   | Sofia | 4   | image-4.png | 2       |
| 3   | Ivan  | 5   | image-5.png | 3       |

---

### Inner Join with condition

- Display only users who commented on their own pics.

**_users_**

| id<sup>PK</sup> | name   |
| --------------- | ------ |
| 1               | Mira   |
| 2               | Sofia  |
| 3               | Ivan   |
| 4               | Metodi |
| 5               | Marina |

**_images_**

| id<sup>PK</sup> | url         | user_id<sup>FK</sup> |
| --------------- | ----------- | -------------------- |
| 1               | image-1.png | 1                    |
| 2               | image-2.png | 1                    |
| 3               | image-3.png | 2                    |
| 4               | image-4.png | 2                    |
| 5               | image-5.png | 3                    |

**_comments_**

| id<sup>PK</sup> | body            | user_id<sup>FK</sup> | image_id<sup>FK</sup> |
| --------------- | --------------- | -------------------- | --------------------- |
| 1               | Pic of me       | 1                    | 3                     |
| 2               | My best picture | 2                    | 5                     |
| 3               | Nature picture  | 3                    | 2                     |

```sql
SELECT body, url, i.user_id AS img_user_id, c.user_id AS com_user_id, c.image_id AS com_img_id
FROM comments AS c INNER JOIN images AS i ON c.image_id = i.id
WHERE c.user_id = i.user_id;
```

| body      | url         | img_user_id | com_user_id | com_img_id |
| --------- | ----------- | ----------- | ----------- | ---------- |
| Pic of me | image-3.png | 2           | 2           | 3          |

---

### Inner Join on generated table

- Except directly selecting a table we can also use generated by union two tables

**_users_**

| id<sup>PK</sup> | name |
| --------------- | ---- |
| 1               | Eli  |
| 2               | Mira |
| 3               | Iva  |

**_charities_**

| id<sup>PK</sup> | amount | user_id<sup>FK</sup> |
| --------------- | ------ | -------------------- |
| 1               | 150    | 1                    |
| 2               | 235    | 1                    |
| 3               | 118    | 2                    |
| 4               | 211    | 3                    |
| 5               | 98     | 3                    |

**_spendings_**

| id<sup>PK</sup> | amount | user_id<sup>FK</sup> |
| --------------- | ------ | -------------------- |
| 1               | 250    | 1                    |
| 2               | 118    | 2                    |
| 3               | 57     | 2                    |
| 4               | 305    | 2                    |
| 5               | 24     | 3                    |

```sql
SELECT name, activities.amount FROM users
INNER JOIN (
  SELECT user_id, amount FROM charities
  UNION ALL
  SELECT user_id, amount FROM spendings
) AS activities ON activities.user_id = users.id;
```

or alternative syntax using Common Table Expression

```sql
WITH activities AS (
  SELECT user_id, amount FROM charities
  UNION ALL
  SELECT user_id, amount FROM spendings
)
SELECT name, activities.amount FROM users
INNER JOIN activities AS activities ON activities.user_id = users.id;
```

| name | amount |
| ---- | ------ |
| Eli  | 150    |
| Eli  | 235    |
| Mira | 118    |
| Iva  | 211    |
| Iva  | 98     |
| Eli  | 250    |
| Mira | 118    |
| Mira | 57     |
| Mira | 305    |
| Iva  | 24     |
